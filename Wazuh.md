# Wazuh
![dab38a8c03e9e6ba3232ded19228f037](https://github.com/s-sparshika/CyberSecurity/assets/68326118/eada1e07-84e8-41ea-8e1a-d54c9f41c4d5)

# Overview:

### Every organizations need a robust security platform to safeguard their digital assets. 
### It is a free and open source security platform designed to provide extended detection and response capabilities, with many features. 
### By leveraging the Elastic Stack for big data processing combined with Wazuh’s efficient indexing technology, organizations can quickly analyze large volumes of log files to detect anomalies or intrusions.
  
### Key Features of Wazuh

- 1. Security Monitoring 

#### Wazuh can be used to monitor the security of an organization's network, systems, and applications. It collects and analyzes logs from various sources, such as operating systems, network devices, and applications, to identify potential security incidents and policy violations.
#### For example, let's say an employee is working remotely using their laptop. Wazuh can monitor the device for any unauthorized access attempts or malware infections. If it detects any suspicious activity like multiple failed login attempts from different IP addresses or unusual data transfers outside of regular business hours, it will alert the security team immediately so they can investigate further.

- 2. Threat Detection and Response

#### Wazuh can detect signs of intrusion or malicious activity within an organization's network. It uses a combination of log analysis, file integrity monitoring, and real-time event correlation to identify suspicious behavior and alert security administrators.
#### For example, we can configure rules that trigger specific actions when certain conditions are met, such as blocking an IP address or quarantining a compromised device. 

- 3. Compliance Management

#### Wazuh provides a range of tools to help us to manage compliance, including policy templates, automated scans, and alerts that notify us when there are potential issues.
#### Using Wazuh's compliance management feature can save our organization a lot of time and effort by automating many routine tasks. 
#### For example, we can use the pre-configured policies included with Wazuh or create custom ones that match our organization's specific needs.

- 4. Log Management and Analysis
#### It  involves collecting and analyzing logs generated by various systems and applications to detect potential security threats. 

- 5. Vulnerability Detection
#### With Wazuh, we can detect known vulnerabilities in applications, operating systems or network services before they are exploited by attackers.
#### Wazuh uses active scanning techniques to conduct vulnerability assessments, providing continuous monitoring of our systems for new vulnerabilities so that we can stay on top of any potential security risk.

# TRY HACKME 

## Task 1: Introduction

### Endpoint detection and response (EDR) are a series of tools and applications that monitor devices for an activity that could indicate a threat or security breach. These tools and applications have features that include:
- Auditing a device for common vulnerabilities
- Proactively monitoring a device for suspicious activity such as unauthorised logins, brute-force attacks or privilege escalations
- Visualising complex data
- Recording a device's normal operating behaviour to help with detecting anomalies
- Created in 2015 
- Open source , freely available and extensive EDR solution.
- It `operated on management and agent module.` :
  #### where the `manager` is responsible for managing agents installed on the devices which we would like to monitor and `Agent` is a device that is being monitored for suspicious activity and potential security threats

![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/71fab6aa-3ecf-4148-814f-14dc21ec3f3a)

### Q. When was Wazuh released?
### A. 2015

### Q. What is the term that Wazuh calls a device that is being monitored for suspicious activity and potential security threats? 
### A. Agents

### Q. Lastly, what is the term for a device that is responsible for managing these devices?
### A. Manager


## Task 2 Deploy Wazuh
### Start attack box - open browser- enter the given HTTP and later enter the credentials.

                    Username: wazuh (make sure that this is lowercase!)
                    Password: eYa0M1-hG0e7rjGi-lRB2qGYVoonsG1K

![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/234da2ff-5e86-4f28-ba7f-1a896c934424)

## Task 3: Wazuh Agent

`Wazuh->Agents->Deploy New Agent`

### Q. How many agents does this Wazuh management server manage?
### A. 2

### Q. What are the status of the agents managed by this Wazuh management server?
### A. Disconnected

![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/808677fe-9903-496b-8dbb-5d1b55d88f9c)


## Task 4: Wazuh Vulnerability Assessment & Security Events

- periodically scan an agent's operating system for installed applications and their version numbers.
-  The gathered data, is sent back to the Wazuh server and compared against a database of CVEs to discover potential vulnerabilities.
-  For example, the agent in the screenshot below has a version of Vim that is vulnerable to CVE-2019-12735.
  
### Q. How many "Security Event" alerts have been generated by the agent "AGENT-001"? Note: You will need to make sure that your time range includes the 11th of March 2022
- To perform the tasks ensure that we are looged in to Wazuh management server 
- Navigate to the Agents tab by pressing Wazuh
- Select agent named "AGENT-001"
### A.196

![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/a06d7c90-b656-4cd0-95d1-98c295020852)

## Task 5: Wazuh Policy Auditing 

Wazuh is capable of auditing and monitoring an agent's configuration - proactively recording event logs. When an audit is performed where a metric is given using multiple frameworks and legislations such as NIST , MITRE and GDPR.

![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/6df5be29-3899-4f8d-859b-26d8f04f8928)

`Wazuh -> Modules and open the "Policy Management" module`

![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/7495b229-1d94-4ec5-930b-8817b5c7b36c)

# Task 6: Monitoring Logons with Wazuh

# Task 7: Collecting Windows Logs with Wazuh
### Q. What is the name of the tool that we can use to monitor system events?
### A. Sysmon

### Q. What standard application on Windows do these system events get recorded to?
### A. Event Viewer

# Task 8: Collecting Linux logs with Wazuh
- Wazuh’s log collector service to create an entry on the agent to instruct what logs should be sent to the Wazuh management server.
- For example, in this task, we will be monitoring the logs of an Apache2 web server. To begin, let’s configure the log collector service on a Linux server running the Wazuh agent.
- Wazuh comes with many rules that enable Wazuh to analyze log files and can be found in /var/ossec/ruleset/rules. Some common applications include:
    Docker
    FTP
    WordPress
    SQL Server
    MongoDB
    Firewalld
And many more.
- In this task, Wazuh will digest Apache2 logs using the 0250-apache_rules.xml ruleset.
- This ruleset can analyze apache2 logs for warnings and error messages like so: We will need to insert this into the Wazuh’s agent that is sending logs to the Wazuh management servers configuration file located in /var/ossec/etc/ossec.conf:
![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/96f67d00-d6f8-4648-846b-af1fd1e62b1d)

### Q. What is the full file path to the rules located on a Wazuh management server?
### A. /var/ossec/ruleset/rules

# Task 9: Auditing commands on linux with Wazhu
- Wazuh utilises the `auditd` package that can be installed on Wazuh agents running on Debian/Ubuntu and CentOS operating systems
- Auditd monitors the system for certain actions and events and will write this to a log file.
- To make sure that auditd is present we need to run the command `sudo apt-get install auditd audispd-plugins` and enable this service to run currently as well as on boot `sudo systemctl enable auditd.service` & `sudo systemctl start auditd.service`
- We should configure auditd to create a rule for the commands and events that we wish for it to monitor. 
- Auditd rules are located in the following directory: `/etc/audit/rules.d/audit.rules`. We will be adding our rules manually.

### Q. What application do we use on Linux to monitor events such as command execution?
### A. auiditd

### Q. What is the full path & filename for where the aforementioned application stores rules?
### A. /etc/audit/rules.d/audit.rules

# Task 10: Wazuh API
### API allow the Wazuh management server to be interacted with using the command line because Wazuh management server requires authentication.
- In this task we use `curl` tool to interact with Wazuh management
- We should authenticate ourselves by providing a valid set of credentials to the authentication endpoint.
- Next, Wazuh management server will give us a token , which is used for further interaction.
- We can also store this token as an environemntal variable on our linux machine :
`TOKEN=$(curl -u : -k -X GET "https://WAZUH_MANAGEMENT_SERVER_IP:55000/security/user/authenticate?raw=true")`

Note: We should replace the WAZUH_MANAGEMENT_SERVER_IP with the IP address of the Wazuh management server 

- To confirm for our authentication &  have been given a token by the Wazuh management server , we check by :

`curl -k -X GET "https://MACHINE_IP:55000/" -H "Authorization: Bearer $TOKEN"`

![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/62f68a20-6966-4f43-9eb0-a963dc176056)

- We use the standard HTTP request methods such as `GET/POST/PUT/DELETE` by providing the relevant option after a -X i.e. -X GET
- For example, List the Wazuh API to some statistics and important information about the Wazuh management server, including what services are being monitored and some general settings about the Wazuh management server:
  `curl -k -X GET "https://MACHINE_IP:55000/manager/configuration?pretty=true§ion=global" -H "Authorization: Bearer $TOKEN"`

![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/a49c3851-4288-4099-b6e2-56ba0be0c8d9)

# Using Wazuh's API console:
- Powerfull integrated API console within the Waziuh website to query management servers and agents.
- To navigate we need to open:
`Wazuh Heading->Tool->API console`
- We will be having a few quiries that we can run .

### Q. What is the name of the standard Linux tool that we can use to make requests to  the Wazuh management server?
### A. curl

### Q. What HTTP method would we use to retrieve information for a Wazuh management server API?
### A. GET

### Q. What HTTP method would we use to perform an action on a Wazuh management server API?
### A. PUT

### Q. Use the API console to find the Wazuh server's version.
### A. v4.2.5


# Task 11: Generating Reports with Wazuh

### Wazuh has a module for reporting which gives us a summarized breakdown view of events that occured on an agent.
- Select a view to generate reports from.
- Go to Modules- > security Events
  
  ![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/ff687372-fd3e-4626-b18d-a82ea67538fd)

 ![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/521ec8d2-77f4-4c05-9119-121909986bfb)


- So if this button is greyed out, there is no report data, so you will either need to change your query or extend the date range.
- Navigate to report overview of dashboard within Wazuh
  `Click Wazuh heading on top of the screen->Management->Reporting`

![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/9d3365ed-f2e3-4b91-8336-473db5051e82)

- This reports generated all the generated reports and to download the report we need to press the download button on the right side located under "Actions"

### Q. Analyse the report. What is the name of the agent that has generated the most alerts?
### A. AGENT-001


# Task 12: Loading Sample Data

### To load the sample data
- Open the "Wazuh" tab in the heading.
- Highlight over "Settings".
- Select the "Sample Data" heading.
- Press the "Add Data" button on the respective three cards to import the data.
  
- And to see data of different ranges we need to choose the range of date accordingly .

![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/918eadbc-4bb0-4b22-b4f0-a4d9280a1d34)

- To set up the time range in splunk after we load data , select calender on the top right corner and follow the steps given in the image below.

![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/d624da33-1a4f-41f8-882b-9d0870e4c7d5)


- To add data in splunk we can add by navigating to search and reporting and then we get add data option

  ![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/37ed35cb-3e33-418b-9f6d-2a2055d3ae12)

- Where as to get data of different time ranges in splunk by choosing the drop down 
  
![image](https://github.com/s-sparshika/CyberSecurity/assets/68326118/7028e32d-9131-42c1-9d47-b600db52122a)




